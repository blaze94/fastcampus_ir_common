{
  "size": 0,
  "aggs": {
    "sales_per_month": {
      "date_histogram": {
        "field": "reg_date",
        "interval": "month"
      },
      "aggs": {
        "sales_sum": {
          "sum": {
            "field": "price"
          }
        }
      }
    },
    "avg_monthly_sales": {
      "avg_bucket": {
        "buckets_path": "sales_per_month>sales_sum"
      }
    }
  }
}